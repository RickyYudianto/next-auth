CreateFunction({
  "name": "login",
  "role": Role("read_users"),
  "body": Query(Lambda(["email", "password"], Let([{
    "res": Login(Match(Index("users_by_email"), Var("email")), {
      "password": Var("password")
    })
  }, {
    "user": Get(Select(["instance"], Var("res")))
  }, {
    "secret": Select(["secret"], Var("res"))
  }], {
    "user": Var("user"),
    "secret": Var("secret")
  })))
})