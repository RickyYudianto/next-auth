"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.frontmatter = void 0;
const helpers_1 = require("../support/helpers");
function frontmatter(context, page) {
    const yaml = `---\n${Object.entries({
        ...context.baseFrontmatterVars(page),
        ...(page.model.comment &&
            getFrontmatterTags(page.model.comment, context.getOption('frontmatterTags'))),
        ...context.getOption('frontmatterGlobals'),
    })
        .map(([key, value]) => `${key}: ${typeof value === 'string' ? `"${value}"` : value}`)
        .join('\n')}\n---`;
    return yaml;
}
exports.frontmatter = frontmatter;
function getFrontmatterTags(comment, frontMatterTags) {
    var _a;
    if (!comment) {
        return {};
    }
    if ((_a = comment.blockTags) === null || _a === void 0 ? void 0 : _a.length) {
        const tags = comment.blockTags
            .filter((tag) => frontMatterTags.includes((0, helpers_1.getTagName)(tag)))
            .reduce((prev, current) => {
            const tagName = (0, helpers_1.getTagName)(current);
            const tagValue = current.content
                .filter((commentPart) => commentPart.kind === 'text')
                .map((commentPart) => commentPart.text)
                .join('');
            return {
                ...prev,
                [tagName]: tagValue,
            };
        }, {});
        return tags;
    }
    return {};
}
